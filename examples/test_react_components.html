<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React AG-UI å¡ç‰‡ç»„ä»¶æµ‹è¯•</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .card {
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        .executing-animation {
            position: relative;
            overflow: hidden;
        }
        .executing-animation::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // ç®€åŒ–çš„åŠ¨ç”»ç»„ä»¶ï¼Œæ›¿ä»£framer-motion
        const motion = {
            div: ({ children, className, style, ...props }) => (
                React.createElement('div', {
                    className: className + (props.whileHover ? ' card' : ''),
                    style: style,
                    ...props
                }, children)
            )
        };

        const AnimatePresence = ({ children }) => children;

        // AG-UI äº‹ä»¶ç±»å‹å®šä¹‰
        const AGUIEventTypes = {
            STATE_SNAPSHOT: 'STATE_SNAPSHOT',
            STATE_DELTA: 'STATE_DELTA',
            TOOL_CALL_START: 'TOOL_CALL_START',
            TOOL_CALL_END: 'TOOL_CALL_END',
            TEXT_MESSAGE_START: 'TEXT_MESSAGE_START',
            TEXT_MESSAGE_CONTENT: 'TEXT_MESSAGE_CONTENT',
            TEXT_MESSAGE_END: 'TEXT_MESSAGE_END',
            STEP_STARTED: 'STEP_STARTED',
            STEP_FINISHED: 'STEP_FINISHED'
        };

        // åŠ¨æ€å†…å®¹ç”Ÿæˆå™¨ç±»
        class DynamicContentGenerator {
            generateContent(eventType, data) {
                const templates = {
                    'TEXT_MESSAGE_START': [
                        'ğŸ¤– AIæ­£åœ¨æ€è€ƒä¸­...',
                        'ğŸ’­ æ­£åœ¨ç»„ç»‡è¯­è¨€...',
                        'âœ¨ æ™ºèƒ½å›å¤ç”Ÿæˆä¸­...'
                    ],
                    'TEXT_MESSAGE_CONTENT': [
                        'ğŸ“ å†…å®¹æ­£åœ¨æµå¼è¾“å‡º...',
                        'âš¡ å®æ—¶ç”Ÿæˆæ–‡æœ¬ä¸­...',
                        'ğŸ”„ åŠ¨æ€æ›´æ–°å†…å®¹...'
                    ],
                    'TOOL_CALL_START': [
                        'ğŸ”§ å·¥å…·è°ƒç”¨å¯åŠ¨ä¸­...',
                        'âš™ï¸ æ‰§è¡Œæ™ºèƒ½å·¥å…·...',
                        'ğŸ› ï¸ å¤„ç†å¤æ‚ä»»åŠ¡...'
                    ],
                    'STEP_STARTED': [
                        'ğŸ“‹ æ­¥éª¤æ‰§è¡Œå¼€å§‹...',
                        'ğŸ¯ ä»»åŠ¡åˆ†è§£å¤„ç†...',
                        'â³ æµç¨‹è¿›è¡Œä¸­...'
                    ],
                    'STATE_DELTA': [
                        'ğŸ”„ çŠ¶æ€æ›´æ–°ä¸­...',
                        'ğŸ“Š æ•°æ®åŒæ­¥ä¸­...',
                        'âš¡ å®æ—¶æ›´æ–°...'
                    ]
                };
                
                const options = templates[eventType] || ['ğŸ”„ å¤„ç†ä¸­...'];
                const randomIndex = Math.floor(Math.random() * options.length);
                return options[randomIndex];
            }
            
            generateProgressText(progress, type) {
                if (progress < 30) {
                    return type === 'message' ? 'ğŸš€ å¼€å§‹ç”Ÿæˆ...' : 'â³ åˆå§‹åŒ–ä¸­...';
                } else if (progress < 70) {
                    return type === 'message' ? 'ğŸ“ å†…å®¹ç”Ÿæˆä¸­...' : 'âš¡ å¤„ç†ä¸­...';
                } else if (progress < 100) {
                    return type === 'message' ? 'âœ¨ å³å°†å®Œæˆ...' : 'ğŸ”„ æœ€åå¤„ç†...';
                } else {
                    return 'âœ… å®Œæˆï¼';
                }
            }
        }

        // å¡ç‰‡ç»„ä»¶
        const CardComponent = ({ card, onAction }) => {
            const getStatusColor = (status) => {
                switch (status) {
                    case 'pending': return 'border-yellow-400 bg-yellow-50';
                    case 'executing': return 'border-blue-400 bg-blue-50';
                    case 'completed': return 'border-green-400 bg-green-50';
                    case 'error': return 'border-red-400 bg-red-50';
                    default: return 'border-gray-400 bg-gray-50';
                }
            };

            const getStatusIcon = (status) => {
                switch (status) {
                    case 'pending': return 'â³';
                    case 'executing': return 'ğŸ”„';
                    case 'completed': return 'âœ…';
                    case 'error': return 'âŒ';
                    default: return 'ğŸ“‹';
                }
            };

            const getTypeIcon = (type) => {
                switch (type) {
                    case 'tool_call': return 'ğŸ”§';
                    case 'message': return 'ğŸ’¬';
                    case 'step': return 'ğŸ“‹';
                    case 'analysis': return 'ğŸ“Š';
                    case 'state': return 'ğŸ¯';
                    default: return 'ğŸ“„';
                }
            };

            return React.createElement(motion.div, {
                className: `relative overflow-hidden rounded-xl border-l-4 p-6 shadow-lg backdrop-blur-sm transition-all duration-300 hover:shadow-xl ${getStatusColor(card.status)} ${card.status === 'executing' ? 'executing-animation' : ''}`,
                whileHover: true
            }, [
                // å¡ç‰‡å¤´éƒ¨
                React.createElement('div', {
                    key: 'header',
                    className: 'flex items-center justify-between mb-4'
                }, [
                    React.createElement('div', {
                        key: 'title-section',
                        className: 'flex items-center space-x-2'
                    }, [
                        React.createElement('span', {
                            key: 'type-icon',
                            className: 'text-2xl'
                        }, getTypeIcon(card.type)),
                        React.createElement('h3', {
                            key: 'title',
                            className: 'text-lg font-semibold text-gray-800'
                        }, card.title)
                    ]),
                    React.createElement('div', {
                        key: 'status-section',
                        className: 'flex items-center space-x-2'
                    }, [
                        React.createElement('span', {
                            key: 'status-icon',
                            className: 'text-lg'
                        }, getStatusIcon(card.status)),
                        React.createElement('span', {
                            key: 'status-badge',
                            className: `px-2 py-1 rounded-full text-xs font-medium uppercase tracking-wide ${
                                card.status === 'pending' ? 'bg-yellow-200 text-yellow-800' :
                                card.status === 'executing' ? 'bg-blue-200 text-blue-800' :
                                card.status === 'completed' ? 'bg-green-200 text-green-800' :
                                card.status === 'error' ? 'bg-red-200 text-red-800' : ''
                            }`
                        }, card.status)
                    ])
                ]),
                // å¡ç‰‡å†…å®¹
                React.createElement('div', {
                    key: 'content',
                    className: 'mb-4'
                }, React.createElement('p', {
                    className: 'text-gray-700 leading-relaxed whitespace-pre-wrap'
                }, card.content)),
                // è¿›åº¦æ¡
                React.createElement('div', {
                    key: 'progress',
                    className: 'mb-4'
                }, [
                    React.createElement('div', {
                        key: 'progress-header',
                        className: 'flex justify-between text-sm text-gray-600 mb-1'
                    }, [
                        React.createElement('span', { key: 'progress-label' }, 'è¿›åº¦'),
                        React.createElement('span', { key: 'progress-value' }, `${card.progress}%`)
                    ]),
                    React.createElement('div', {
                        key: 'progress-bar-container',
                        className: 'w-full bg-gray-200 rounded-full h-2'
                    }, React.createElement('div', {
                        className: `h-2 rounded-full transition-all duration-500 ${
                            card.status === 'completed' ? 'bg-green-500' :
                            card.status === 'error' ? 'bg-red-500' :
                            card.status === 'executing' ? 'bg-blue-500' :
                            'bg-yellow-500'
                        }`,
                        style: { width: `${card.progress}%` }
                    }))
                ]),
                // å¡ç‰‡å…ƒæ•°æ®
                React.createElement('div', {
                    key: 'metadata',
                    className: 'flex justify-between items-center text-sm text-gray-500 border-t pt-3'
                }, [
                    React.createElement('span', { key: 'type' }, `ç±»å‹: ${card.type}`),
                    React.createElement('span', { key: 'timestamp' }, card.timestamp)
                ])
            ]);
        };

        // ä¸»è¦çš„å¡ç‰‡æ¸²æŸ“å™¨ç»„ä»¶
        const CardRenderer = ({ wsUrl = 'ws://localhost:8000/ws', onCardAction }) => {
            const [cards, setCards] = useState(new Map());
            const [connectionStatus, setConnectionStatus] = useState('disconnected');
            const [logs, setLogs] = useState([]);
            const wsRef = useRef(null);
            const taskCounterRef = useRef(0);
            const dynamicContentGenerator = useRef(new DynamicContentGenerator());

            // æ—¥å¿—è®°å½•å‡½æ•°
            const addLog = useCallback((type, message) => {
                const timestamp = new Date().toLocaleTimeString();
                setLogs(prev => {
                    const newLogs = [...prev, { timestamp, type, message }];
                    return newLogs.slice(-100);
                });
            }, []);

            // æ¨¡æ‹Ÿä»»åŠ¡æµç¨‹
            const simulateTaskFlow = useCallback(() => {
                taskCounterRef.current += 1;
                const taskId = `task_${taskCounterRef.current}`;
                
                addLog('DEMO', 'å¼€å§‹æ¨¡æ‹Ÿä»»åŠ¡æµç¨‹');
                
                // 1. å·¥å…·è°ƒç”¨å¼€å§‹
                setTimeout(() => {
                    const toolEvent = {
                        event_type: 'TOOL_CALL_START',
                        call_id: `tool_${taskId}`,
                        tool_name: 'data_analyzer',
                        arguments: { query: 'åˆ†æç”¨æˆ·è¡Œä¸ºæ•°æ®' },
                        timestamp: Date.now()
                    };
                    handleToolCallStart(toolEvent);
                }, 500);
                
                // 2. æ–‡æœ¬æ¶ˆæ¯å¼€å§‹
                setTimeout(() => {
                    const messageEvent = {
                        event_type: 'TEXT_MESSAGE_START',
                        message_id: `msg_${taskId}`,
                        role: 'assistant',
                        timestamp: Date.now()
                    };
                    handleTextMessageStart(messageEvent);
                }, 1000);
                
                // 3. æ–‡æœ¬æ¶ˆæ¯å†…å®¹æ›´æ–°
                setTimeout(() => {
                    const contentEvent = {
                        event_type: 'TEXT_MESSAGE_CONTENT',
                        message_id: `msg_${taskId}`,
                        content: dynamicContentGenerator.current.generateContent('TEXT_MESSAGE_START', { role: 'assistant' }),
                        timestamp: Date.now()
                    };
                    handleTextMessageContent(contentEvent);
                }, 1500);
                
                // 4. å·¥å…·è°ƒç”¨ç»“æŸ
                setTimeout(() => {
                    const toolEndEvent = {
                        event_type: 'TOOL_CALL_END',
                        call_id: `tool_${taskId}`,
                        result: { status: 'success', data: 'åˆ†æå®Œæˆï¼Œå‘ç°3ä¸ªå…³é”®è¶‹åŠ¿' },
                        timestamp: Date.now()
                    };
                    handleToolCallEnd(toolEndEvent);
                }, 2000);
                
                // 5. æ–‡æœ¬æ¶ˆæ¯ç»“æŸ
                setTimeout(() => {
                    const messageEndEvent = {
                        event_type: 'TEXT_MESSAGE_END',
                        message_id: `msg_${taskId}`,
                        content: 'âœ… æ•°æ®åˆ†æä»»åŠ¡å·²å®Œæˆï¼å‘ç°äº†ç”¨æˆ·è¡Œä¸ºçš„3ä¸ªå…³é”®è¶‹åŠ¿ï¼Œå»ºè®®ä¼˜åŒ–äº§å“ä½“éªŒã€‚',
                        timestamp: Date.now()
                    };
                    handleTextMessageEnd(messageEndEvent);
                }, 2500);
            }, [addLog]);

            // äº‹ä»¶å¤„ç†å‡½æ•°
            const handleToolCallStart = useCallback((event) => {
                const dynamicContent = dynamicContentGenerator.current.generateContent('TOOL_CALL_START', event);
                const cardData = {
                    id: event.call_id,
                    title: `ğŸ”§ ${event.tool_name}`,
                    content: dynamicContent,
                    status: 'executing',
                    type: 'tool_call',
                    timestamp: new Date().toLocaleTimeString(),
                    progress: 0,
                    metadata: { arguments: event.arguments }
                };

                setCards(prev => new Map(prev).set(event.call_id, cardData));
                addLog('TOOL', `å·¥å…·è°ƒç”¨å¼€å§‹: ${event.tool_name}`);
            }, [addLog]);

            const handleToolCallEnd = useCallback((event) => {
                setCards(prev => {
                    const newCards = new Map(prev);
                    const card = newCards.get(event.call_id);
                    if (card) {
                        const completionText = dynamicContentGenerator.current.generateProgressText(100);
                        newCards.set(event.call_id, {
                            ...card,
                            status: 'completed',
                            content: `${completionText}\nå·¥å…·æ‰§è¡Œå®Œæˆ\nç»“æœ: ${JSON.stringify(event.result, null, 2)}`,
                            progress: 100,
                            metadata: { ...card.metadata, result: event.result }
                        });
                    }
                    return newCards;
                });
                addLog('TOOL', `å·¥å…·è°ƒç”¨ç»“æŸ: ${event.call_id}`);
            }, [addLog]);

            const handleTextMessageStart = useCallback((event) => {
                const dynamicContent = dynamicContentGenerator.current.generateContent('TEXT_MESSAGE_START', event);
                const cardData = {
                    id: event.message_id,
                    title: `ğŸ’¬ ${event.role || 'assistant'} æ¶ˆæ¯`,
                    content: dynamicContent,
                    status: 'executing',
                    type: 'message',
                    timestamp: new Date().toLocaleTimeString(),
                    progress: 0
                };

                setCards(prev => new Map(prev).set(event.message_id, cardData));
                addLog('MESSAGE', `æ¶ˆæ¯å¼€å§‹: ${event.message_id}`);
            }, [addLog]);

            const handleTextMessageContent = useCallback((event) => {
                setCards(prev => {
                    const newCards = new Map(prev);
                    const card = newCards.get(event.message_id);
                    if (card) {
                        newCards.set(event.message_id, {
                            ...card,
                            content: event.content || '',
                            progress: Math.min(card.progress + 20, 90)
                        });
                    }
                    return newCards;
                });
            }, []);

            const handleTextMessageEnd = useCallback((event) => {
                setCards(prev => {
                    const newCards = new Map(prev);
                    const card = newCards.get(event.message_id);
                    if (card) {
                        const completionText = dynamicContentGenerator.current.generateProgressText(100);
                        newCards.set(event.message_id, {
                            ...card,
                            status: 'completed',
                            content: `${completionText}\n${event.content || card.content}`,
                            progress: 100
                        });
                    }
                    return newCards;
                });
                addLog('MESSAGE', `æ¶ˆæ¯ç»“æŸ: ${event.message_id}`);
            }, [addLog]);

            // æ¸…ç©ºå¡ç‰‡
            const clearCards = useCallback(() => {
                setCards(new Map());
                addLog('UI', 'å·²æ¸…ç©ºæ‰€æœ‰å¡ç‰‡');
            }, [addLog]);

            return React.createElement('div', {
                className: 'container mx-auto p-6 bg-white/10 backdrop-blur-md rounded-2xl shadow-2xl'
            }, [
                // æ ‡é¢˜
                React.createElement('div', {
                    key: 'header',
                    className: 'text-center mb-8'
                }, [
                    React.createElement('h1', {
                        key: 'title',
                        className: 'text-4xl font-bold text-white mb-2'
                    }, 'ğŸš€ React AG-UI å¡ç‰‡ç»„ä»¶'),
                    React.createElement('p', {
                        key: 'subtitle',
                        className: 'text-white/80 text-lg'
                    }, 'åŠ¨æ€äº‹ä»¶å¤„ç†ä¸æ™ºèƒ½UIæ¸²æŸ“æ¼”ç¤º')
                ]),
                
                // æ§åˆ¶é¢æ¿
                React.createElement('div', {
                    key: 'controls',
                    className: 'bg-white/20 backdrop-blur-sm rounded-xl p-6 mb-8'
                }, [
                    React.createElement('div', {
                        key: 'control-header',
                        className: 'flex items-center justify-between mb-4'
                    }, [
                        React.createElement('h2', {
                            key: 'control-title',
                            className: 'text-xl font-semibold text-white'
                        }, 'ğŸ® æ§åˆ¶é¢æ¿'),
                        React.createElement('div', {
                            key: 'connection-status',
                            className: 'flex items-center space-x-2'
                        }, [
                            React.createElement('div', {
                                key: 'status-indicator',
                                className: `w-3 h-3 rounded-full ${
                                    connectionStatus === 'connected' ? 'bg-green-400' :
                                    connectionStatus === 'connecting' ? 'bg-yellow-400' :
                                    'bg-red-400'
                                }`
                            }),
                            React.createElement('span', {
                                key: 'status-text',
                                className: 'text-white text-sm'
                            }, connectionStatus === 'connected' ? 'å·²è¿æ¥' :
                               connectionStatus === 'connecting' ? 'è¿æ¥ä¸­' : 'æœªè¿æ¥')
                        ])
                    ]),
                    React.createElement('div', {
                        key: 'buttons',
                        className: 'flex flex-wrap gap-3'
                    }, [
                        React.createElement('button', {
                            key: 'simulate-btn',
                            onClick: simulateTaskFlow,
                            className: 'px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors font-medium'
                        }, 'ğŸ­ æ¨¡æ‹Ÿä»»åŠ¡æµç¨‹'),
                        React.createElement('button', {
                            key: 'clear-btn',
                            onClick: clearCards,
                            className: 'px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors font-medium'
                        }, 'ğŸ—‘ï¸ æ¸…ç©ºå¡ç‰‡')
                    ])
                ]),
                
                // å¡ç‰‡ç½‘æ ¼
                React.createElement('div', {
                    key: 'cards-grid',
                    className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8'
                }, React.createElement(AnimatePresence, {}, 
                    Array.from(cards.values()).map((card) => 
                        React.createElement(CardComponent, {
                            key: card.id,
                            card: card,
                            onAction: onCardAction
                        })
                    )
                )),
                
                // æ—¥å¿—é¢æ¿
                React.createElement('div', {
                    key: 'logs',
                    className: 'bg-black/20 backdrop-blur-sm rounded-xl p-6'
                }, [
                    React.createElement('h3', {
                        key: 'logs-title',
                        className: 'text-lg font-semibold text-white mb-4'
                    }, 'ğŸ“‹ äº‹ä»¶æ—¥å¿—'),
                    React.createElement('div', {
                        key: 'logs-container',
                        className: 'bg-black/40 rounded-lg p-4 h-48 overflow-y-auto font-mono text-sm'
                    }, logs.slice(-20).map((log, index) => 
                        React.createElement('div', {
                            key: index,
                            className: `mb-1 ${
                                log.type === 'ERROR' ? 'text-red-300' :
                                log.type === 'SUCCESS' ? 'text-green-300' :
                                log.type === 'WARNING' ? 'text-yellow-300' :
                                'text-gray-300'
                            }`
                        }, `[${log.timestamp}] ${log.type}: ${log.message}`)
                    ))
                ])
            ]);
        };

        // ä½¿ç”¨ç¤ºä¾‹ç»„ä»¶
        const CardRendererExample = () => {
            const handleCardAction = (action, cardId) => {
                console.log(`æ‰§è¡Œæ“ä½œ: ${action} on card: ${cardId}`);
            };

            return React.createElement(CardRenderer, {
                wsUrl: 'ws://localhost:8000/ws',
                onCardAction: handleCardAction
            });
        };

        // æ¸²æŸ“åº”ç”¨
        ReactDOM.render(
            React.createElement(CardRendererExample),
            document.getElementById('root')
        );
    </script>
</body>
</html>